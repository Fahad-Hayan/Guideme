{% extends 'base.html' %}
{% load static%}
{% block content %}
{% if country %}
<div class="container-fluid vh-100 d-flex align-items-center justify-content-center"
    style="background-image: url({{country.image.url}}); background-size: cover; background-position: center;">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card" id="welcome-card">
                <div class="card-body">
                    <h1 class="card-title">Welcome to {{country.name}}</h1>
                    <p class="card-text text-black">{{country.description}}</p>
                    <div class="text-center">
                        <a href="#more-section" class="btn btn-primary">Learn More</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<section id="more-section">
    <div class="container pt-5">
        <h3 class="fw-bolder text-uppercase d-inline">Description about <span class="text-primary">{{country.name}}</span></h3>
        <ul class="list-group mt-3 mb-5">
            <li class="list-group-item ps-3 pb-0">
                <p><span
                        class="description">{{country.description|linebreaksbr}} </span><a class="see-more-link btn-link">See
                        More</a></p>
            </li>
        </ul>
        <h3 class="fw-bolder text-uppercase d-inline">The cities of "<span class="text-primary">{{country.name}}</span>" based on their categories</h3>
        <div class="accordion mb-5 mt-3" id="accordionExample">
            <div class="accordion-item">
            {% for category in categories %}
            <h2 class="accordion-header" id="heading{{category.id}}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse{{category.id}}" aria-expanded="true" aria-controls="collapse{{category.id}}">
                    {% if category.type == 'Not Specified' %}{{category.type}}{% else %} {{category.type}} Tourism{% endif %}
                </button>
            </h2>
            {% for city in cities %}
            {% if country == city.country and category == city.category %}
            <!--  -->
                <div id="collapse{{category.id}}" class="accordion-collapse collapse show"
                    aria-labelledby="heading{{category.id}}">
                    <div class="accordion-body p-0">
                        <div class="column">
                            <div class="card text-light mt-3 p-0" id="{{city.name}}">
                                <a href="{{city.country}}/{{city.id}}">
                                    <img src="{{city.image.url}}" alt="{{city.name}}" class="card-img-top">
                                    <div class="card-body">
                                        <div class="badge-container">
                                            <div class="badge">{{city.category}} Tourism</div>
                                        </div>
                                        <h4 class="card-title">{{city.name}} <sub>{{city.country}}</sub></h4>
                                        <p class="card-text">{{city.caption}}</p>
                                        <p id="exchange-text">USD exchange rate: ${{city.exchangeRate}}</p>
                                        <p id="rating-text"><img src="{% static 'img/Icons/star-filled.svg' %}"
                                                id="star-icon" class="d-inline">
                                            {{city.rating}}</p>
                                    </div>
                                </a>
                                {% if user.is_authenticated %}
                    {% if city in user.wishlist.cities.all %}
                    <form action="{% url 'wishlist_add_remove' city.id %}" method="POST" target="wishlist-iframe">
                        {% csrf_token %}
                        <button type="submit" id="favorite-btn" class="wishlist-btn"><img
                            class="{{city.name}}F-icon" src="{% static 'img/Icons/Favorite-filled.svg' %}"></b>
                    </form>
                    
                    {% else %}
                    <form action="{% url 'wishlist_add_remove' city.id %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" id="favorite-btn" class="wishlist-btn"><img
                            class="{{city.name}}F-icon" src="{% static 'img/Icons/Favorite-outlined.svg' %}"></button>
                    </form>
                    {% endif %}
                    {% else %}
                    <a href="{% url 'signin' %}" id="favorite-btn" class="wishlist-btn"><img
                        class="{{city.name}}F-icon" src="{% static 'img/Icons/Favorite-outlined.svg' %}"></a>
                    {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!--  -->
                
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="container text-center">
            <div class="row">
                {% for count in countries %}
                <div class="column col-md-2 col-sm-2">
                    <div class="card text-light p-0" id="{{count.name}}">
                        <a href="countries/{{count.name}}">
                            <img src="{{count.image.url}}" alt="{{count.name}}" class="card-img-top">
                            <div class="card-body">
                                <h4 class="card-title">{{count.name}}</h4>
                            </div>
                        </a>
                    </div>
                </div>
    
                {% endfor %}
            </div>
            
        </div>
        {% endif %}
    </div>
</section>

<script>
    const description = document.querySelector('.description');
    const seeMoreLink = document.querySelector('.see-more-link');
    const maxLength = 260;

    if (description.innerHTML.length > maxLength) {
        const shortDescription = description.innerHTML.slice(0, maxLength) + '... ';
        const fullDescription = description.innerHTML
        description.innerHTML = shortDescription;

        seeMoreLink.addEventListener('click', () => {
            if (description.innerHTML === shortDescription) {
                description.innerHTML = fullDescription.replace('\r\n','<br>');
                seeMoreLink.innerHTML = 'See Less';
            } else {
                description.innerHTML = shortDescription.replace('\r\n','<br>');
                seeMoreLink.innerHTML = 'See More';
            }
        });
    } else {
        seeMoreLink.remove();
    }
</script>
{% endblock content %}